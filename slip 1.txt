#Q1
#include <stdio.h>
#include <stdlib.h>


int pointer;
int faults ,hits;

void display(int frame_size,int frame[])
{
	int i;
	printf("Frames:: ");
	for(i=0;i<frame_size;i++)
	{
		if(frame[i]==-1)
			printf("- ");
		else
			printf("%d ",frame[i]);
	}

	printf("\n");
}

int predict(int reference_length, int references[], int page_no ,int frame_size,int frame[], int start)
{
	int pos = -1, farthest = start, i;
	for(i=0;i<frame_size;i++)
	{
		int j;
		for(j=start-1;j>=0;j--)
		{
			if(frame[i]==references[j])
			{
				if(j<farthest)
				{
					farthest=j;
					pos=i;
				}
				break;
			}
		}
		if(j==page_no)
			return i;
	}
	if(pos == -1)
		return 0;
	else
		return pos;
}

void add_reference(int frame_size,int frame[], int reference, int current_position,int reference_length, int references[])
{
	int i;
	int allocated=0;
	for(i=0;i<frame_size;i++)
	{
		
		if(frame[i]==reference)
		{
			printf("  Hit for %d | ", reference);
			hits++;
			allocated = 1;
			break;
		}
		else if(frame[i]==-1)
		{
			frame[i] = reference;
			printf("Fault for %d | ", reference);
			faults++;
			allocated = 1;
			break;
		}
	}
	if(allocated==0)
	{
		int j = predict(reference_length,references,current_position,frame_size,frame,current_position+1);

		frame[j] = reference;
		printf("Fault for %d | ", reference);
		faults++;	
	}
	display(frame_size, frame);
}

int main()
{
	int frame_size,i,number_of_references;
	int frame[10];
	int reference[100];
	printf("Enter frame size: ");
	scanf("%d",&frame_size);
	
	for(i=0;i<frame_size;i++)
	{
		frame[i] = -1;
	}

	display(frame_size,frame);
	
	printf("Enter the number of references: ");
	scanf("%d",&number_of_references);
	
	
	for(i=0;i<number_of_references;i++)
	{
		scanf("%d",&reference[i]);
		add_reference(frame_size,frame,reference[i],i,number_of_references,reference);
	}
	printf("\nNumber of faults: %d \nNumber of hits: %d\n",faults,hits );
}

---------OR-------------
#include <stdio.h>
#include <stdlib.h>


int pointer;
int faults ,hits;

void display(int frame_size,int frame[])
{
	int i;
	printf("Frames:: ");
	for(i=0;i<frame_size;i++)
	{
		if(frame[i]==-1)
			printf("- ");
		else
			printf("%d ",frame[i]);
	}

	printf("\n");
}

int predict(int reference_length, int references[], int page_no ,int frame_size,int frame[], int start)
{
	int pos = -1, farthest = start, i;
	for(i=0;i<frame_size;i++)
	{
		int j;
		for(j=start-1;j>=0;j--)
		{
			if(frame[i]==references[j])
			{
				if(j<farthest)
				{
					farthest=j;
					pos=i;
				}
				break;
			}
		}
		if(j==page_no)
			return i;
	}
	if(pos == -1)
		return 0;
	else
		return pos;
}

void add_reference(int frame_size,int frame[], int reference, int current_position,int reference_length, int references[])
{
	int i;
	int allocated=0;
	for(i=0;i<frame_size;i++)
	{
		
		if(frame[i]==reference)
		{
			printf("  Hit for %d | ", reference);
			hits++;
			allocated = 1;
			break;
		}
		else if(frame[i]==-1)
		{
			frame[i] = reference;
			printf("Fault for %d | ", reference);
			faults++;
			allocated = 1;
			break;
		}
	}
	if(allocated==0)
	{
		int j = predict(reference_length,references,current_position,frame_size,frame,current_position+1);

		frame[j] = reference;
		printf("Fault for %d | ", reference);
		faults++;	
	}
	display(frame_size, frame);
}

int main()
{
	int frame_size,i,number_of_references;
	int frame[10];
	int reference[100];
	printf("Enter frame size: ");
	scanf("%d",&frame_size);
	
	for(i=0;i<frame_size;i++)
	{
		frame[i] = -1;
	}

	display(frame_size,frame);
	
	printf("Enter the number of references: ");
	scanf("%d",&number_of_references);
	
	
	for(i=0;i<number_of_references;i++)
	{
		scanf("%d",&reference[i]);
		add_reference(frame_size,frame,reference[i],i,number_of_references,reference);
	}
	printf("\nNumber of faults: %d \nNumber of hits: %d\n",faults,hits );
}


#Q2
// Write a C program to implement the shell which displays the command prompt “myshell$”.
// It accepts the command, tokenize the command line and execute it by creating the child process.

// Also implement the additional command ‘typeline’ as

//  typeline +n filename :- To print first n lines in the file.
//  typeline -n filename :- To print last n lines in the file.
//  typeline a filename :- To print all lines in the file.

#include <unistd.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/wait.h>

void make_toks(char *s, char *tok[])
{
  int i = 0;
  char *p;
  p = strtok(s, " ");
  while (p != NULL)
  {
    tok[i++] = p;
    p = strtok(NULL, " ");
  }
  tok[i] = NULL;
}

void typeline(char *fn, char *op)
{
  int fh, i, j, n;
  char c;
  fh = open(fn, O_RDONLY);
  if (fh == -1)
  {
    printf("File %s not found.\n", fn);
    return;
  }
  if (strcmp(op, "a") == 0)
  {
    while (read(fh, &c, 1) > 0)
      printf("%c", c);
    close(fh);
    return;
  }
  n = atoi(op);
  if (n > 0)
  {
    i = 0;
    while (read(fh, &c, 1) > 0)
    {
      printf("%c", c);
      if (c == '\n')
        i++;
      if (i == n)
        break;
    }
  }
  if (n < 0)
  {
    i = 0;
    while (read(fh, &c, 1) > 0)
      if (c == '\n')
        i++;
    lseek(fh, 0, SEEK_SET);
    j = 0;
    while (read(fh, &c, 1) > 0)
    {
      if (c == '\n')
        j++;
      if (j == i + n)
        break;
    }
    while (read(fh, &c, 1) > 0)
      printf("%c", c);
  }
  close(fh);
}

int main()
{
  char buff[80], *args[10];
  int pid , status;
  while (1)
  {
    printf("myshell$ ");
    fflush(stdin);
    fgets(buff, 80, stdin);
    buff[strlen(buff) - 1] = '\0';
    make_toks(buff, args);
    if (strcmp(args[0], "typeline") == 0)
      typeline(args[2], args[1]);
    else
    {
      pid = fork();
      if (pid > 0)
        wait(&status);
      else
        if (execvp(args[0], args) == -1)
          printf("Bad command.\n");
    }
  }

  return 0;
}

